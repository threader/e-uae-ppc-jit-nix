E-UAE PowerPC JIT project 0.8.29-PPCJITBETA05
=============================================

This project is a fork of the E-UAE Amiga emulation project. You can find the
original project's pages here:

http://www.rcdrummond.net/uae

Please also read the details of the original project in the included
README_original file.

The goal of the project is implementing Just-In-Time compiling for PowerPC
processors, using (some of) the already available intel x86 implementation.

For further details please have a look on the project blog:

http://euaejit.blogspot.com


You can find the actual project sources in the SourceForge project:

https://sourceforge.net/projects/euaeppcjit


If you would like to support the project then please consider a small donation:

http://amigabounty.net/index.php?function=viewproject&projectid=35

Thank you!


Beta release #5 (PPCJITBETA05)
===================================
The most important features of the fifth beta version are:

 * Lots of bug fixes again.
 
 * 68060 processor emulation can use of JIT (cache handling is fixed) - lots
   of the scene demos are checking for the processor type.

 * Diagnostic configuration option is implemented for detecting
   non-JIT-compatible self-modifying programs.

This is the final beta version before the first public release.
   
You can get an idea of the remaining work by looking at the tickets:

https://sourceforge.net/p/euaeppcjit/tickets

Please read the How to test and the Known issues sections carefully before
you start using the release.

You can also find a comparison of the original E-UAE v0.8.29 and this version
in the What is the difference section.

Please note: the tools for the emulator are not included in this beta package.
If you need these tools (for example: mousehack, make-hdf, rtg.library, etc.)
then please use them from a previous E-UAE release.
This emulator is backward compatible with the original v0.8.29, you can use
the same tools or even the same configuration files with some JIT compiling-
related changes.


Files in this package
=====================
You can find the following directories and files in the package:

  docs       - documentation from the original E-UAE sources with adjustments
  COPYING    - license document
  README     - this file what you are reading now
  README_original - original README file that came with v0.8.29
  uae        - Generic E-UAE executable compiled for running in an Amiga window


What is the difference
======================
Here are the differences between the original v0.8.29 and this version:

* Some minor fixes were applied on certain files when it was necessary.

* The x86 JIT compiling were removed completely.

* The PowerPC JIT compiling were implemented from scratch, some support 
  functions were reused from the x86 implementation.
  
* New configuration items are available for the new JIT implementation.
  (See docs/configuration.txt.)
  
* CyberGraphX overlay screen support (for MorphOS only at the moment)
  
* Some configuration items for JIT were removed.
  (See docs/configuration.txt.)

* An indicator LED were introduced for the JIT compiler state.
  (See docs/configuration.txt.)

* Collected the various fixes from different individual forked releases of the
  original E-UAE versions.

* G5 (PowerPC 970/FX/GX/MP) support.
  
All other aspects of the emulation remained the same as it was available
already in E-UAE v0.8.29 (as of 20/08/2008).


Changes since the previous release (JITPPCBETA04)
=================================================

New/Changed:
------------

* Implemented "comp_test_consistency" option for detecting self-modifying
  code which is not compatible with the JIT compiler.


Improved:
---------

* Some speed-up for block compiling: debug output is not generated into a
  string unless logging is turned on.

* Checking for enabled compiler log (comp_log setting) added to the dump of
  the compiled code (comp_log_compiled) to avoid slowdowns when compiled code
  dumping is enabled without enabling compiler log.

* Invalid complex addressing mode bits are ignored. (Ticket #48)

* Removed useless checking of buffer overrun from the code. The overrun
  margin will be checked at the beginning of compiling for each block.

* Adjusted cache line sizes for inval_icache_range. (Estimated/maybe spotted
  a 0.00002% speed up - Thanks to Mike Blackburn.)

* cdrtools URL is updated in the documentation (Thanks to Mike Blackburn.)

* Removed TODO and commented out code for detecting small blocks. (Ticket #35)


Fixed:
------

* Removed explicit check for 68040 in cache register handling to unblock
  turning on the instruction cache for 68060. (Ticket #3)

* Wrong field name for comp_log_compiled option in fix_options() function is
  fixed.

* Fixed accidental modification of X flag in some ROR/ROL instructions.

* Fixed missing calculation of X flag in LSR/LSL reg,reg and wrong register
  dependency in LSR reg,reg instructions. (Ticket #64)

* Fixed result copying in ROR.B/W Dx,Dy. (Ticket #63)

* Reset temporary register assignments at the beginning of each block
  compiling. (Ticket #52)

* PEA (A7) is fixed to use the original A7 content before it is decreased as
  the source. (Ticket #51)

* Specialties (chipset steps) were not executed every time after returning
  from compiled code. (Ticket #53)

* Fixed bootstraping - AC_CONFIGS_LINKS cannot find libscg & libschilly thus
  failed to properly generate build files. (Thanks to Mike Blackburn.)

* Removed unused option from GTK GUI. (Thanks to Mike Blackburn.)
  

How to test
===========
First of all: please read the available configuration items in the
docs/configuration.txt file, especially regarding the JIT compiling
configuration.

You can reuse the same configuration files, HD image files, prepared folders
that were already working with the previous E-UAE version.

However, for testing the JIT implementation please make sure you set up
the configuration exactly as listed below:
    cpu_speed=max
    cpu_type=68020 (or 68EC020, 68040, 68060, see Known issues)
    cpu_compatible=false
    cpu_cycle_exact=false
    blitter_cycle_exact=false
    comp_optimize=true
    cachesize=8192 (or higher)
    comp_constjump=yes
    comp_trustbyte=indirect (see Known issues)
    comp_trustword=indirect
    comp_trustlong=indirect

These settings will make sure you get the best performance from the JIT
compiled code and workaround the known issues.

Please have a look at the docs/configuration.txt file for the details of
these settings.

Regarding the processor settings please note: the JIT implementation is
depending on the availability of the processor cache, any software that turns
the cache off won't be JIT compiled.
Same applies to the processor type: those processors which don't have cache
cannot be used together with the JIT compiling (these are: 68000, 68010).

In case you are not sure whether the JIT compiling works or not with your
configuration: turn on the JIT LED. (See show_leds in docs/configuration.txt.)
If the JIT was set up properly then the JIT LED will blink green on the screen.

For G5 (PowerPC 970/FX/GX/MP) users:
(Applicable to MacOSX only at the moment.)
Please use the binary from the archive which is tagged with "G5": E-UAE_G5.
The generic build is running on G5, but it is much slower due to missing
instructions which are emulated by the operating system.

For MorphOS G5 (PowerPC 970/FX/GX/MP) users:
G5 processor is not supported in this beta release. Currently the PPC970 target
is not supported by the official SDK, as soon as this situation is improved
I will release a special build for G5 processors.
The current build will not perform well on G5 due to the missing instructions
on the G5 architecture.


How to report a bug
===================
When you think you have found a bug and would like to report it please make
sure you follow these steps:

1. Check whether the bug was already known. You can find the bug tickets on
   the SourceForge project page: https://sourceforge.net/p/euaeppcjit/tickets

2. Make sure you are using the most recent version of the emulator.
   Check the SourceForge page for any updates:
   https://sourceforge.net/p/euaeppcjit

   You can check the version of your emulator when you start it from command
   line, this will be the very first output from the program.

   On AmigaOS(-like) systems you can also use the standard version command to
   get the version of the UAE executable.

   The version number includes a tag for the beta releases, for example:
   0.8.29-PPCJITBETA05

3. Make sure the JIT compiling is running, read through the How to test
   section and follow the instructions regarding the configuration.
   
4. Try to run the emulated program with this diagnostic option in the
   emulation configuration:
   
   comp_test_consistency=true
   
   If the emulator quits with this error message:
   "JIT: cache consistency error, memory changed since code was compiled"
   
   Then the emulated program is not compatible with the current implementation
   of JIT compiling.

5. Try to reproduce the bug without optimization: turn off the optimization
   in the configuration and try to reproduce the bug. (comp_optimize=false)

6. Try to reproduce the bug without JIT compiling: turn off the JIT compiling
   in the configuration and try to reproduce the bug. (Option: cachesize=0)

7. If you were able to reproduce the bug without JIT compiling then try to
   reproduce it on the previous version of E-UAE.
   If you are able to reproduce it then it is a generic E-UAE bug. Fixing
   these issues is not a goal for the E-UAE PPC JIT project. You might still
   report it, but most likely it won't be fixed in this project.

8. If you think you had found a bug related to the JIT compiling then try to
   make sure you can reproduce the bug consistently (or often enough) and
   please describe the exact details, provide the software that triggers the
   problem.

9. See the Contacts section for getting in touch with me. Gather all the
   information and send it to me by email.


Known issues
============
* The following instructions are planned, but not implemented yet for the
  JIT compiling at the moment:

  - (Ticket #8) compare against bounds instructions (CMP2);

  - (Ticket #10) the FPU instructions were not implemented yet, these are coming
    at a later stage of the project.

  Even though these instructions are not compiled, a fall-back mechanism kicks
  in and these will be executed by the interpretive emulation.
  Any software that is relying on these instructions will be still working.

* This is a debug version, so probably it is a little bit slower than the 
  release version will be (including the non-JIT code).
  
* (Ticket #11) E-UAE does not support 68030 processor type, if this processor
  was selected then it falls back to 68010.

* (Ticket #12) As it is stated in the original configuration documentation:
  the 68060 emulation is incomplete, therefore it might not work properly.

* (Ticket #15) The direct memory access is not completed yet, theoretically it
  might work for certain software, but I suggest to turn it off by adding these
  lines to the configuration: 
    comp_trustbyte=indirect
    comp_trustword=indirect
    comp_trustlong=indirect

* (Ticket#19) On-screen LEDs are not visible on the Picasso96 RTG screens,
  so the JIT LED indicator is not useful on these screen modes.


Where to get the sources
========================
You can find the current project sources at the SourceForge project pages:

https://sourceforge.net/projects/euaeppcjit


Notes for compiling the sources
===============================
For general notes for compiling please refer to the README_original file.

To compile on Mac OSX 10.3.9 or earlier:

Autoconf2.57 and automake1.6 mess up @OBJCFLAGS@ and is not really compatible. 

Get the correct versions - replacing the previous version :
http://ftp.gnu.org/gnu/autoconf/autoconf-2.61.tar.bz2
./configure --bindir=/usr/bin --datarootdir=/usr/share && make install
http://ftp.gnu.org/gnu/automake/automake-1.7.9.tar.bz2
./configure --bindir=/usr/bin --datadir=/usr/share && make install

For Mac OSX 10.4.x and 10.3.x: 
Latest SDL.framework is not properly detected. 
Using the SDL.framework already in E-UAE.app/Content/Frameworks at
http://www.rcdrummond.net/uae
Copy SDL.framework/Headers from the latest SDL.framework and put the framework
in /Library/Frameworks/
./configure --enable-jit --without-x --with-sdl-gl --with-cocoa-gui

Source installed SDL is also detected.

For AmigaOS4:
You need to link libamiga to the binary otherwise the TimeDelay macro won't
work. To do so add this parameter to the configure script:
./configure LIBS=-lamiga


Contact
=======
Send any opinion, bug reports, patches, etc. to
Almos Rajnai (almos dot rajnai at GMail)

You can also get in touch with me using the Contact form at the project blog:
http://euaejit.blogspot.com


Special thanks
==============
I would like to thank the constant support to

  Thunder, kas1e, MickJT, Fab, Luigi Burdo, Samir Hawamdeh,
  Tobias Netzel, Mike Blackburn and Chris Handley

for helping me with lots of things regarding bug finding, fixing,
platform support and constantly watching out for the updates on the repository.

